{% extends 'base.html' %}

{% block content %}
<div class="card mx-auto" style="max-width:720px;">
  <div class="card-body">
    <h1 class="h4 mb-3">Редактировать альбом</h1>
    <form method="post">
      {% csrf_token %}
      {% if form.non_field_errors %}
        <div class="alert alert-danger">{{ form.non_field_errors }}</div>
      {% endif %}

      <div class="mb-3">
        {{ form.title.label_tag }}
        {{ form.title }}
        {% if form.title.errors %}<div class="text-danger small">{{ form.title.errors }}</div>{% endif %}
      </div>

      <div class="mb-3">
        {{ form.description.label_tag }}
        {{ form.description }}
        {% if form.description.errors %}<div class="text-danger small">{{ form.description.errors }}</div>{% endif %}
      </div>

      <div class="mb-3 form-check">
        {{ form.is_public }}
        {{ form.is_public.label_tag }}
        {% if form.is_public.errors %}<div class="text-danger small">{{ form.is_public.errors }}</div>{% endif %}
      </div>

      <div class="mb-3">
        {{ form.view_password.label_tag }}
        {{ form.view_password }}
        <small class="form-text text-muted">Пароль для просмотра (оставьте пусто, если не требуется)</small>
        {% if form.view_password.errors %}<div class="text-danger small">{{ form.view_password.errors }}</div>{% endif %}
      </div>

      <button type="submit" class="btn btn-primary">Сохранить</button>
      <a href="{% url 'album_detail' album.id %}" class="btn btn-link">Отмена</a>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const isPublicCheckbox = document.getElementById('id_is_public');
  const viewPasswordField = document.getElementById('id_view_password');
  
  if (isPublicCheckbox && viewPasswordField) {
    // Функция для обновления состояния поля view_password
    function updateViewPasswordState() {
      if (isPublicCheckbox.checked) {
        // Если альбом публичный - отключаем поле view_password
        viewPasswordField.disabled = true;
        viewPasswordField.value = '';
      } else {
        // Если альбом приватный - включаем поле view_password
        viewPasswordField.disabled = false;
      }
    }
    
    // Вызовем при загрузке страницы
    updateViewPasswordState();
    
    // Слушаем изменения чекбокса
    isPublicCheckbox.addEventListener('change', updateViewPasswordState);
  }
});
</script>

{% endblock %}
